# 加密交易分析AI助手 - 产品需求文档

## 一、产品概述

### 1.1 产品定位
**产品名称**：加密交易分析AI助手  
**目标用户**：加密货币交易者、投资者、市场分析师  
**核心价值**：通过自然语言对话，一站式获取多源加密市场数据并获取AI分析见解，降低数据获取门槛，提高决策效率

### 1.2 产品愿景
打造最简洁、最高效的加密市场对话式分析工具，让用户像与专家聊天一样获取市场洞察。

---

## 二、用户场景与需求分析

### 2.1 核心用户场景

| 用户类型 | 典型使用场景 | 核心需求 |
|---------|-------------|----------|
| **零售交易者** | 快速查询币种价格、24小时变化 | 实时数据、简洁界面、移动端友好 |
| **中阶投资者** | 分析市场趋势、查看K线形态 | 多维度分析、历史数据对比、技术指标 |
| **市场研究员** | 获取资金费率、套利机会分析 | 深度数据、多交易所对比、专业工具 |

### 2.2 功能需求优先级

**P0（核心功能）**：
1. 基础对话界面（消息收发、历史记录）
2. 多AI模型切换（DeepSeek/千问）
3. 加密数据查询（价格、K线、基本信息）
4. 移动端自适应布局

**P1（增强功能）**：
1. 自动模型切换策略
2. 对话记录智能管理
3. 数据可视化图表
4. 常用查询模板

**P2（扩展功能）**：
1. 多语言支持
2. 自定义监控列表
3. 预警通知功能
4. 数据导出

---

## 三、产品功能规格

### 3.1 用户界面设计

#### 3.1.1 整体布局
```
┌─────────────────────────────────────────────────────────────┐
│ [菜单按钮] Crypto AI Analyzer                    [模型切换] │
├───────────────────┬─────────────────────────────────────────┤
│                   │                                         │
│                   │  Hi，我是您的加密交易助手，            │
│  今天             │  可以帮您查询实时价格、分析市场趋势...  │
│  └─ BTC价格？    │                                         │
│                   │  【回复内容】                           │
│  昨天             │                                         │
│  └─ ETH分析      │                                         │
│                   │                                         │
│  上周             │  【新消息...】                         │
│  └─ 资金费率     │                                         │
│                   ├─────────────────────────────────────────┤
│                   │  [输入框] 请输入您的问题... [发送按钮]   │
└───────────────────┴─────────────────────────────────────────┘
```

#### 3.1.2 移动端适配方案
- **折叠式侧边栏**：点击左上角菜单图标展开/收起历史记录
- **底部固定输入**：输入区域始终保持在屏幕底部
- **手势支持**：右滑打开历史记录，左滑关闭
- **触摸优化**：按钮尺寸、间距符合移动端操作习惯

### 3.2 对话系统设计

#### 3.2.1 核心交互流程
```
用户输入问题 → 选择AI模型 → 调用MCP工具 → AI分析整合 → 返回回答 → 自动存储
```

#### 3.2.2 消息流设计
- **实时滚动**：新消息自动滚动到可视区域
- **加载状态**：AI思考时显示加载动画
- **错误处理**：网络异常时友好提示
- **重试机制**：失败请求可一键重试

### 3.3 AI模型管理

#### 3.3.1 可用模型
| 模型 | 特点 | 适用场景 |
|------|------|----------|
| **DeepSeek** | 免费、中文优化、推理能力强 | 深度分析、逻辑推理 |
| **千问** | 阿里生态、金融领域优化 | 市场分析、数据解读 |
| **自动模式** | 智能切换、负载均衡 | 日常查询、通用场景 |

#### 3.3.2 切换策略
- **手动切换**：用户显式选择
- **自动切换**：系统根据以下因素决策：
  - 响应速度（选择最快的）
  - 任务类型（技术分析选DeepSeek，市场数据选千问）
  - 使用频率（轮询避免单一模型过载）

### 3.4 数据服务集成

#### 3.4.1 MCP服务矩阵（直接接入，无需开发，参考配置：/Users/wangtao/.kiro/settings/mcp.json）
| 服务源 | 数据范围 | 查询示例 |
|--------|----------|----------|
| **Binance** | 现货/合约价格、资金费率、Alpha令牌 | "BTC当前价格"、"ETH资金费率" |
| **CoinGecko** | 代币信息、市场排名、趋势榜单 | "Solana详细信息"、"当前热门币种" |
| **Crypto.com** | 市场行情、K线数据 | "ADA/USDT 1小时K线" |

#### 3.4.2 数据时效性策略
- **实时数据**：价格、资金费率（<5秒缓存）
- **高频数据**：K线、交易对（1分钟缓存）
- **低频数据**：代币信息、市场列表（1小时缓存）

### 3.5 历史记录管理

#### 3.5.1 存储架构
```
storage/
├── chats/
│   ├── 2024-01-20/
│   │   ├── chat_001.json (最多10MB)
│   │   └── chat_002.json
│   ├── 2024-01-19/
│   └── ...
```

#### 3.5.2 清理策略
- **时间维度**：默认保留30天，可配置（7/30/90天）
- **空间维度**：单文件10MB分割，自动压缩旧文件
- **手动管理**：支持批量删除、导出单日记录

---

## 四、用户体验设计

### 4.1 视觉设计原则
- **极简主义**：去除非必要元素，聚焦核心功能
- **暗色主题**：默认暗色模式，适合长时间查看
- **信息密度**：合理平衡信息量与可读性
- **一致性**：保持交互逻辑、视觉风格统一

### 4.2 交互细节设计

#### 4.2.1 消息气泡
- **用户消息**：深色背景
- **AI回复**：浅色背景
- **数据内容**：特殊格式突出显示数值、百分比

#### 4.2.2 加载状态
```javascript
// 三阶段加载指示
1. "正在查询数据..."     // 调用MCP服务
2. "分析数据中..."       // AI处理
3. "生成回答中..."       // 整理输出
```

#### 4.2.3 错误状态
- **网络错误**：显示重试按钮，保持输入内容
- **服务限流**：建议切换模型或稍后重试
- **数据缺失**：说明原因，建议替代查询方式

### 4.3 移动端特殊设计

#### 4.3.1 手势交互
- **右滑**：打开历史记录侧边栏
- **左滑**：关闭侧边栏或删除对话
- **下拉**：刷新消息列表
- **长按**：复制消息内容

#### 4.3.2 空间利用
- **输入框**：点击后自动上推，避免键盘遮挡
- **历史列表**：支持搜索过滤，快速定位
- **底部导航**：常用操作快捷入口（新对话、切换模型）

---

## 五、部署与维护方案

### 5.1 技术架构简图
```
用户请求 → Nginx → Node.js应用 → AI模型API
                ↓                ↘ MCP服务
          静态资源             数据存储
```

### 5.2 部署流程

#### 5.2.1 一键部署脚本功能（参考：/Users/wangtao/crypto/deploy_simple.sh，Nginx内含域名配置）
1. **环境检查**：Node.js版本、端口占用、目录权限
2. **依赖安装**：自动安装所需npm包
3. **配置引导**：交互式创建.env配置文件
4. **服务启动**：启动应用并设置开机自启
5. **健康检查**：验证服务是否正常运行

#### 5.2.2 配置文件示例
```env
# 应用配置
APP_NAME=Crypto AI Analyzer
DEFAULT_MODEL=deepseek
RETENTION_DAYS=30

# AI服务（用户自行申请）
DEEPSEEK_API_KEY=sk-xxxxxxxx
QWEN_API_KEY=sk-yyyyyyyy

# 服务器
PORT=3000
ENV=production
```

### 5.3 维护策略

#### 5.3.1 数据清理
- **自动任务**：每天凌晨清理过期记录
- **空间监控**：磁盘使用率超过80%时告警
- **日志轮转**：应用日志按大小和时间切割

#### 5.3.2 监控指标
1. **服务可用性**：API响应时间、成功率
2. **用户体验**：页面加载时间、交互延迟
3. **资源使用**：内存占用、CPU使用率
4. **数据质量**：MCP服务成功率、数据延迟

---

## 六、产品路线图

### 阶段一：MVP（1-2周）
**目标**：基础对话功能上线
- [ ] 核心对话界面
- [ ] DeepSeek模型接入
- [ ] Binance数据源
- [ ] 本地历史记录

### 阶段二：功能完善（3-4周）
**目标**：完善用户体验
- [ ] 千问模型接入
- [ ] 多数据源整合
- [ ] 移动端适配
- [ ] 自动清理功能

### 阶段三：体验优化（5-6周）
**目标**：提升用户留存
- [ ] 数据可视化
- [ ] 快捷查询模板
- [ ] 性能优化
- [ ] 错误处理优化

### 阶段四：扩展功能（7-8周）
**目标**：增加高级功能
- [ ] 预警通知
- [ ] 数据导出
- [ ] API开放
- [ ] 团队协作功能

---

## 七、成功指标

### 7.1 核心指标
- **日活跃用户（DAU）**：目标100+
- **平均会话时长**：目标>5分钟
- **用户留存率**：次日留存>30%，7日留存>15%

### 7.2 功能指标
- **查询成功率**：>95%
- **响应时间**：平均<3秒
- **模型使用分布**：DeepSeek/千问/自动≈40%/30%/30%

### 7.3 业务指标
- **用户满意度**：NPS>30
- **功能使用率**：多模型切换>50%用户
- **数据查询类型**：价格查询/技术分析/市场数据≈60%/25%/15%

---

## 八、风险与对策

### 8.1 技术风险
| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| AI服务不稳定 | 中 | 高 | 多模型备用、本地缓存 |
| MCP服务变更 | 低 | 中 | 抽象接口层、快速适配 |
| 移动端兼容性 | 中 | 中 | 渐进增强、降级方案 |

### 8.2 运营风险
| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| API调用超限 | 中 | 高 | 使用量监控、自动切换 |
| 数据准确性 | 低 | 高 | 多源验证、异常检测 |
| 用户数据安全 | 低 | 高 | 本地存储、传输加密 |

---

## 附录

### A. 术语表
- **MCP**：Model Context Protocol，模型上下文协议
- **资金费率**：永续合约市场的资金费用
- **Alpha令牌**：Binance Launchpool的代币
- **K线**：蜡烛图，展示价格走势的技术图表

### B. 参考设计
- **界面参考**：chat.deepseek.com 的简洁设计
- **交互参考**：移动端聊天应用的通用模式
- **数据展示**：交易平台的清晰数据呈现

### C. 联系方式
- **产品负责人**：[待补充]
- **技术负责人**：[待补充]
- **用户反馈**：通过应用内反馈表单

---

**文档版本**：v1.0  
**更新日期**：2024年1月20日  
**评审状态**：待评审

*本产品文档旨在为开发团队提供清晰的产品需求和设计指导，确保最终产品符合用户期望和商业目标。*